<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Configuration Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
</head>
<body>
    <h1>Supabase Configuration Test</h1>
    <div id="results"></div>
    
    <script>
        const results = document.getElementById('results');
        
        function log(message) {
            console.log(message);
            results.innerHTML += `<p>${message}</p>`;
        }
        
        async function testSupabaseConfig() {
            log('=== SUPABASE CONFIGURATION TEST ===');
            
            // Test 1: Config loading
            if (!window.UNILINGO_CONFIG) {
                log('❌ UNILINGO_CONFIG not loaded');
                return;
            }
            
            const config = window.UNILINGO_CONFIG;
            log('✅ Config loaded successfully');
            log(`Supabase URL: ${config.supabase.url}`);
            log(`Anon Key (first 20 chars): ${config.supabase.anonKey.substring(0, 20)}...`);
            
            // Test 2: Supabase client creation
            try {
                const supabase = window.supabase.createClient(config.supabase.url, config.supabase.anonKey);
                log('✅ Supabase client created');
                
                // Test 3: Connection test
                log('Testing Supabase connection...');
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    log(`❌ Connection error: ${error.message}`);
                } else {
                    log('✅ Supabase connection successful');
                    log(`Session status: ${session ? 'Active' : 'None'}`);
                }
                
                // Test 4: Test password reset email (this will help identify the issue)
                log('=== PASSWORD RESET EMAIL TEST ===');
                log('Enter an email address to test password reset:');
                
                // Create a simple form for testing
                const testForm = document.createElement('div');
                testForm.innerHTML = `
                    <input type="email" id="testEmail" placeholder="Enter email to test" style="padding: 10px; margin: 10px 0;">
                    <button onclick="testPasswordReset()" style="padding: 10px 20px;">Test Password Reset</button>
                `;
                results.appendChild(testForm);
                
                // Make testPasswordReset globally available
                window.testPasswordReset = async function() {
                    const email = document.getElementById('testEmail').value;
                    if (!email) {
                        log('❌ Please enter an email address');
                        return;
                    }
                    
                    log(`Testing password reset for: ${email}`);
                    try {
                        const { error } = await supabase.auth.resetPasswordForEmail(email, {
                            redirectTo: `${window.location.origin}/reset-password.html`
                        });
                        
                        if (error) {
                            log(`❌ Password reset failed: ${error.message}`);
                            log(`Error details: ${JSON.stringify(error)}`);
                        } else {
                            log('✅ Password reset email sent successfully!');
                            log('Check your email and click the reset link.');
                        }
                    } catch (err) {
                        log(`❌ Exception: ${err.message}`);
                    }
                };
                
            } catch (error) {
                log(`❌ Supabase client creation failed: ${error.message}`);
            }
        }
        
        document.addEventListener('DOMContentLoaded', testSupabaseConfig);
    </script>
</body>
</html>
