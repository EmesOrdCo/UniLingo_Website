<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Supabase Configuration - UniLingo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .fix-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #1976d2;
        }
        .critical {
            border-left-color: #d32f2f;
            background: #ffebee;
        }
        .success {
            border-left-color: #388e3c;
            background: #e8f5e8;
        }
        .warning {
            border-left-color: #f57c00;
            background: #fff3e0;
        }
        .code {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        .step {
            background: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 3px solid #1976d2;
        }
        .copy-btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <h1>üîß Fix Supabase Configuration</h1>
    
    <div class="fix-section critical">
        <h2>üö® CRITICAL ISSUE IDENTIFIED</h2>
        <p><strong>Problem:</strong> Supabase is generating error URLs instead of token URLs in password reset emails.</p>
        <p><strong>Root Cause:</strong> Supabase project configuration mismatch.</p>
    </div>

    <div class="fix-section">
        <h2>üìç Step 1: Fix Supabase Authentication Settings</h2>
        <p>Go to your Supabase Dashboard ‚Üí Authentication ‚Üí URL Configuration</p>
        
        <div class="step">
            <h3>1.1 Site URL</h3>
            <p>Set this EXACTLY to:</p>
            <div class="code">
                https://unilingo.co.uk
                <button class="copy-btn" onclick="copyToClipboard('https://unilingo.co.uk')">Copy</button>
            </div>
            <p><strong>Important:</strong> No trailing slash, no www, exact match</p>
        </div>

        <div class="step">
            <h3>1.2 Redirect URLs</h3>
            <p>Add these URLs (one per line):</p>
            <div class="code">
                https://unilingo.co.uk/reset-password.html
                <button class="copy-btn" onclick="copyToClipboard('https://unilingo.co.uk/reset-password.html')">Copy</button>
            </div>
            <p><strong>Important:</strong> Exact match with no trailing slash</p>
        </div>
    </div>

    <div class="fix-section">
        <h2>üìß Step 2: Verify Email Template</h2>
        <p>Go to Authentication ‚Üí Email Templates ‚Üí Reset Password</p>
        
        <div class="step">
            <h3>2.1 Subject Line</h3>
            <div class="code">
                Reset your UniLingo password
            </div>
        </div>

        <div class="step">
            <h3>2.2 Body Template</h3>
            <p>Make sure your template uses:</p>
            <div class="code">
                {{ .ConfirmationURL }}
            </div>
            <p><strong>Note:</strong> Your template already uses this correctly ‚úÖ</p>
        </div>
    </div>

    <div class="fix-section">
        <h2>üîê Step 3: Check SMTP Configuration</h2>
        <p>Go to Authentication ‚Üí SMTP Settings</p>
        
        <div class="step">
            <h3>3.1 SMTP Settings</h3>
            <p>Verify these settings match your Brevo configuration:</p>
            <div class="code">
                Host: smtp-relay.brevo.com
                Port: 587
                Username: 9778bd001@smtp-brevo.com
                Password: [Your Brevo SMTP Key]
                Sender Email: unilingo.help@gmail.com
                Sender Name: UniLingo Support
            </div>
        </div>
    </div>

    <div class="fix-section">
        <h2>üß™ Step 4: Test After Configuration</h2>
        <p>After making the above changes:</p>
        
        <div class="step">
            <h3>4.1 Wait 2-3 minutes</h3>
            <p>Supabase configuration changes take a few minutes to propagate.</p>
        </div>

        <div class="step">
            <h3>4.2 Test Password Reset</h3>
            <p>Go to: <a href="https://unilingo.co.uk/sign-in.html" target="_blank">https://unilingo.co.uk/sign-in.html</a></p>
            <p>Click "Forgot your password?" and test again.</p>
        </div>
    </div>

    <div class="fix-section warning">
        <h2>‚ö†Ô∏è Common Mistakes to Avoid</h2>
        <ul>
            <li>‚ùå Don't use <code>www.unilingo.co.uk</code> (use <code>unilingo.co.uk</code>)</li>
            <li>‚ùå Don't add trailing slashes to URLs</li>
            <li>‚ùå Don't use different domains or subdomains</li>
            <li>‚ùå Don't mix HTTP and HTTPS</li>
            <li>‚úÖ Use exact case-sensitive matches</li>
        </ul>
    </div>

    <div class="fix-section success">
        <h2>‚úÖ Expected Result</h2>
        <p>After fixing the configuration, the password reset email should contain a URL like:</p>
        <div class="code">
            https://unilingo.co.uk/reset-password.html#access_token=eyJ...&refresh_token=eyJ...&expires_in=3600&token_type=bearer&type=recovery
        </div>
        <p>Instead of the current error URL.</p>
    </div>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                alert('Copied to clipboard!');
            });
        }
    </script>
</body>
</html>
